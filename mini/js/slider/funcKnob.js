var __decorate=this&&this.__decorate||function(t,e,s,i){var a,r=arguments.length,o=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,s,i);else for(var n=t.length-1;n>=0;n--)(a=t[n])&&(o=(r<3?a(o):r>3?a(e,s,o):a(e,s))||o);return r>3&&o&&Object.defineProperty(e,s,o),o},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};import*as decorator from"../decorator.js";let KnobSlider=class{constructor(t,e,s,i,a){this.circles=[],this.centerX=0,this.centerY=0,this.isRotating=!1,this.lastTap=0,this.angle=0,this.totalValue=0,this.startRotation=t=>{const e=this.knob.getBoundingClientRect();this.centerX=e.left+this.knob.clientWidth/2,this.centerY=e.top+this.knob.clientHeight/2,this.isRotating=!0},this.rotateKnob=t=>{if("touchmove"===t.type&&t.preventDefault(),!this.isRotating)return;let e,s;if(t instanceof TouchEvent&&t.touches.length>0)e=t.touches[0].clientX,s=t.touches[0].clientY;else{if(!(t instanceof MouseEvent))return;e=t.clientX,s=t.clientY}const i=e-this.centerX,a=s-this.centerY,r=(180*Math.atan2(a,i)/Math.PI-(90+this.offset)+360)%360,o=r/360;if(this.infinite){const t=r-this.angle;if(t>180){if(!this.totalValue)return void this.outOfBoundaries(0,0,0);this.totalValue-=this.maxValue}else t<-180&&(this.totalValue+=this.maxValue)}this.angle=r,this.offset&&r>360-2*this.offset?r>360-this.offset?this.outOfBoundaries(0,0,0):this.outOfBoundaries(this.dash,this.maxValue,360-2*this.offset):this.setDashArray(o)},this.slider=t,this.knob=t.querySelector(".knob"),this.pointer=t.querySelector(".pointer-frame"),this.value=t.querySelector(".value"),this.exactValue=t.querySelector(".exact-value");const r=Array.from(t.querySelectorAll("circle"));this.circles=r.slice(1),this.circleCount=this.circles.length,this.offset=Math.round((360-i)/2);const o=parseFloat(r[0].getAttribute("r"))||130;this.circumference=2*Math.PI*o,this.percentage=1/this.circles.length,this.dash=this.circumference*this.percentage,i<360&&(this.dash+=1),this.valueCoef=i/360,this.defaultValue=e,this.maxValue=s,this.infinite=a;for(const[t,e]of r.entries()){if(i<360){if(t===r.length-1){e.style.display="none";continue}e.style.strokeLinecap="unset"}e.style.strokeDasharray=""+this.circumference*i/360,e.style.transform=`rotate(${this.offset+Math.round(360*(t>0?t-1:t)/this.circleCount)}deg)`}this.initListeners(),this.resetKnob()}setDashArray(t){const e=Math.floor(t*this.circleCount),s=this.circumference/this.valueCoef;for(const[i,a]of this.circles.entries())if(i===e){const e=this.circumference*(t-this.percentage*i);a.style.strokeDasharray=`${e} ${s}`}else a.style.strokeDasharray=i<e?`${this.dash} ${s}`:`0 ${s}`;this.pointer.style.transform=`rotate(${360*t+this.offset}deg)`;const i=this.totalValue+t*this.maxValue/this.valueCoef;this.value.innerHTML=i.toFixed(0),this.exactValue.value=i.toString()}outOfBoundaries(t,e,s){const i=this.circumference/this.valueCoef;for(const[e,s]of this.circles.entries())s.style.strokeDasharray=`${t} ${i}`;this.value.innerHTML=e.toString(),this.exactValue.value=e.toString(),this.pointer.style.transform=`rotate(${s+this.offset}deg)`}resetKnob(){const t=this.defaultValue/this.maxValue;this.angle=(360-2*this.offset)*this.defaultValue/this.maxValue,this.totalValue=0,this.isRotating=!1;const e=this.defaultValue/this.valueCoef;this.value.innerHTML=e.toFixed(0),this.exactValue.value=e.toString(),this.pointer.style.transform=`rotate(${360*t+this.offset}deg)`,this.setDashArray(t)}initListeners(){if("ontouchstart"in window||navigator.maxTouchPoints>0){const t=t=>{t.preventDefault();const e=(new Date).getTime(),s=e-this.lastTap;s<300&&s>0&&this.resetKnob(),this.lastTap=e};this.slider.addEventListener("touchstart",this.startRotation,{passive:!1}),document.addEventListener("touchmove",this.rotateKnob,{passive:!1}),document.addEventListener("touchend",(()=>this.isRotating=!1)),this.knob.addEventListener("touchstart",t,{passive:!1})}else this.slider.addEventListener("mousedown",this.startRotation),document.addEventListener("mousemove",this.rotateKnob),document.addEventListener("mouseup",(()=>this.isRotating=!1)),this.knob.addEventListener("dblclick",(()=>this.resetKnob()))}};__decorate([decorator.CatchErrors,decorator.MeasureExecutionTime,__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",void 0)],KnobSlider.prototype,"setDashArray",null),__decorate([decorator.CatchErrors,decorator.MeasureExecutionTime,__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Number,Number]),__metadata("design:returntype",void 0)],KnobSlider.prototype,"outOfBoundaries",null),__decorate([decorator.CatchErrors,decorator.MeasureExecutionTime,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],KnobSlider.prototype,"resetKnob",null),__decorate([decorator.CatchErrors,decorator.MeasureExecutionTime,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],KnobSlider.prototype,"initListeners",null),KnobSlider=__decorate([decorator.LogClassCreation,decorator.MeasureConstructionTime,__metadata("design:paramtypes",[HTMLElement,Number,Number,Number,Boolean])],KnobSlider);export{KnobSlider};